<?xml version="1.0" encoding="UTF-8"?>
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:override="http://www.riotfamily.org/schema/common/override"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/util
		http://www.springframework.org/schema/util/spring-util-2.5.xsd
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
		http://www.riotfamily.org/schema/common/override
		http://www.riotfamily.org/schema/common/override-8.0.xsd">

	<bean id="pageFormInitializer" class="org.riotfamily.pages.riot.form.PageFormInitializer">
		<constructor-arg ref="pageTypeHierarchy" />
		<constructor-arg ref="contentFormRepository" />
	</bean>

	<bean id="sitePropertiesFormInitializer" class="org.riotfamily.pages.riot.form.SiteFormInitializer">
		<constructor-arg ref="contentFormRepository" />
	</bean>

	<!-- Overrides -->

	<override:bean ref="componentFormController" class="org.riotfamily.pages.riot.form.PagePropertiesFormController">
		<constructor-arg ref="formContextFactory" />
		<constructor-arg ref="contentFormRepository" />
		<constructor-arg ref="transactionManager" />
		<constructor-arg ref="componentDao" />
		<constructor-arg ref="cacheService" />
	</override:bean>
	
	<override:add ref="messageBasenames" append="true">
		<value>classpath:/org/riotfamily/pages/runtime/i18n/messages</value>
	</override:add>
	
	<override:add ref="customStyleSheets">
		<value>style/riot-pages.css</value>
	</override:add>
	
	<override:add ref="formRepository" property="configLocations" append="true">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>
	
	<!-- 
	<override:add ref="listRepository" property="configLocations">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>
	
	<override:add ref="editorRepository" property="configLocations">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>
 	-->
 	
	<override:add ref="resourceMappings" append="true">			
		<bean class="org.riotfamily.core.resource.ResourceMapping">
			<property name="path" value="/" />
			<property name="location" value="classpath:/org/riotfamily/pages/runtime/resources/" />
		</bean>
	</override:add>
	
	<override:properties ref="riotUserDao">
		<property name="entityClass" value="org.riotfamily.pages.riot.security.SiteUser" />
	</override:properties>
	
	<!-- DAOs and models -->

	<bean id="siteRiotDao" class="org.riotfamily.pages.riot.dao.SiteRiotDao" />

 	<bean id="pageRiotDao" class="org.riotfamily.pages.riot.dao.PageRiotDao" />
	
	<bean id="locales" class="org.riotfamily.pages.riot.form.SiteLocalesOptionsModel" />

	<!-- Policies -->
	
	<bean id="siteUserPolicy" class="org.riotfamily.pages.riot.security.SiteUserPolicy">
		<constructor-arg ref="pageResolver" />
	</bean>
	
	<bean id="systemPagePolicy" class="org.riotfamily.pages.riot.security.SystemPagePolicy" />
	
	<!--  FreeMarker Object Wrappers  -->
	
	<bean id="siteObjectWrapperPlugin" class="org.riotfamily.pages.view.SiteObjectWrapperPlugin" />
	
	<bean id="pageObjectWrapperPlugin" class="org.riotfamily.pages.view.PageObjectWrapperPlugin">
		<property name="pathConverter" ref="pathConverter" />
	</bean>
	
	<bean id="sitemap" class="org.riotfamily.core.screen.list.TreeListScreen">
		<property name="dao" ref="pageRiotDao" />
		<property name="columns">
			<list>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="property" value="title" />
				</bean>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="property" value="pathComponent" />
				</bean>
				<!-- 
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="renderer">
						<bean class="org.riotfamily.pages.riot.ui.PublishStatusRenderer" />
					</property>
				</bean>
				 -->
			</list>
		</property>
		<property name="commands">
			<list>
				<bean class="org.riotfamily.core.screen.list.command.EditCommand" />
				<bean class="org.riotfamily.core.screen.list.command.AddCommand" />
			</list>
		</property>
		<property name="itemScreen">
			<bean id="page" class="org.riotfamily.core.screen.form.FormScreen" autowire="constructor" />
		</property>
	</bean>
	
	<bean id="localContent" class="org.riotfamily.core.screen.list.TreeListScreen">
		<property name="dao">
			<bean class="org.riotfamily.riot.hibernate.dao.HqlDao" autowire="constructor">
				<property name="entityClass" value="org.riotfamily.example.petstore.Pet" />
			</bean>
		</property>
		<property name="columns">
			<list>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="property" value="locale" />
				</bean>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="property" value="name" />
				</bean>
			</list>
		</property>
		<property name="commands">
			<list>
				<bean class="org.riotfamily.core.screen.list.command.EditCommand" />
			</list>
		</property>
		<property name="itemScreen">
			<bean id="localSitemap" parent="sitemap" />
		</property>
	</bean>
	
	<!-- 
	<ed:list id="localContent" list-ref="site-chooser" icon="world">
		<ed:tree id="sitemap" list-ref="pages" icon="sitemap">
			<ed:form id="page" form-ref="page" />
		</ed:tree>
	</ed:list>
	
	<ed:group name="systemPreferences" icon="tools">
		<ed:list id="manageSites" list-ref="sites" icon="world">
			<ed:form form-ref="site">
				<ed:form form-ref="siteProperties" />
			</ed:form>
		</ed:list>
	</ed:group>

	<list:list id="site-chooser" label-property="name">
		<list:dao ref="siteRiotDao" />
		<list:columns>
			<list:column property="locale" renderer="countryFlagRenderer" />
			<list:column property="name" />
			<list:command id="edit" />
		</list:columns>
	</list:list>
	
	<list:list id="sites" label-property="name">
		<list:dao ref="siteRiotDao" />
		<list:columns>
			<list:column property="locale" renderer="countryFlagRenderer" />
			<list:column property="name" />
			<list:column property="enabled" />
			<list:command id="edit" />
			<list:command id="stepInto" />
			<list:command id="moveUp" />
			<list:command id="moveDown" />
			<list:command id="delete" />
			<list:command id="gotoSite" />
		</list:columns>
		<list:command id="add" />
	</list:list>
	
	<list:list id="pages">
		<list:dao ref="pageRiotDao" />
		<list:columns>
			<list:column property="title" />
			<list:column property="pathComponent" />
			<list:column renderer="org.riotfamily.pages.riot.ui.PublishStatusRenderer" />
			<list:command id="editPage" />
			<list:command id="translatePage" />
			<list:command id="publishPage" />
			<list:command id="discardPage" />
			<list:command id="unpublishPage" />
			<list:command id="deletePage" />
			<list:command id="moveUpPage" />
			<list:command id="moveDownPage" />
			<list:command id="cutPage" />
			<list:command id="gotoPage" />
		</list:columns>
		<list:command id="add"/>
		<list:command id="pastePage" />
	</list:list>
	-->
	
</beans>
