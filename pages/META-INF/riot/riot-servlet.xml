<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!--
	  - Controller that displays the sitemap as DHTML tree. Used by the
	  - internalLink form element.
	  -->
	<bean id="pageChooserController" name="/pages/chooser"
		class="org.riotfamily.pages.riot.chooser.PageChooserController">

		<constructor-arg ref="pageDao" />
		<constructor-arg ref="pageLocationResolver" />
		<property name="locales" ref="websiteLocales" />
	</bean>

	<!-- Module configuration -->

	<bean id="pagesModule" class="org.riotfamily.common.beans.module.FactoryBeanModule">
		<property name="properties">
			<map>
				<entry key="messageSourceBasenames">
					<value>classpath:/org/riotfamily/pages/runtime/i18n/messages</value>
				</entry>
				<entry key="resourceMappings">
					<list>
						<bean class="org.riotfamily.common.web.resource.ResourceMapping">
							<property name="path" value="/" />
							<property name="location" value="classpath:/org/riotfamily/pages/runtime/resources/" />
						</bean>
					</list>
				</entry>
				<entry key="customStyleSheets">
					<list>
						<value>style/riot-pages.css</value>
					</list>
				</entry>
				<entry key="customFormElements">
					<props>
						<prop key="internalLink">org.riotfamily.pages.riot.chooser.InternalLinkField</prop>
					</props>
				</entry>
				<entry key="formConfigLocations">
					<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
				</entry>
				<entry key="listConfigLocations">
					<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
				</entry>
				<entry key="editorConfigLocations">
					<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="siteRiotDao" class="org.riotfamily.pages.riot.dao.SiteRiotDao">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="localeRiotDao" class="org.riotfamily.pages.riot.dao.LocaleRiotDao">
		<constructor-arg ref="websiteLocales" />
		<constructor-arg ref="pageDao" />
  	</bean>

 	<bean id="pageRiotDao" class="org.riotfamily.pages.riot.dao.PageRiotDao">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="editPageCommand" class="org.riotfamily.pages.riot.command.EditPageCommand">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="deletePageCommand" class="org.riotfamily.pages.riot.command.DeletePageCommand" />

	<bean id="showChildPagesCommand" class="org.riotfamily.pages.riot.command.ShowChildPagesCommand" />

	<bean id="publishPageCommand" class="org.riotfamily.pages.riot.command.PublishPageCommand" />

	<bean id="gotoPageCommand" class="org.riotfamily.pages.riot.command.GotoPageCommand">
		<constructor-arg ref="pageLocationResolver" />
		<property name="windowName" value="preview" />
	</bean>

	<!--
	  - FormRepository providing page property forms.
	  -->
	<bean id="pageComponentFormRepository" parent="componentFormRepository">
		<property name="config" value="/WEB-INF/website-config/page-forms.xml" />
	</bean>

	<!--
	  - Controller that renders forms to edit component properties.
	  -->
	<bean id="pageComponentFormController"
		name="/pages/form/@{formId}/@{containerId}"
		class="org.riotfamily.pages.component.PageComponentFormController">
		<constructor-arg ref="pageComponentFormRepository" />
		<constructor-arg ref="componentRepository" />
		<constructor-arg ref="pageComponentFormRegistry" />
		<constructor-arg ref="componentDao" />
		<property name="formContextFactory" ref="formContextFactory" />
	</bean>

	<bean id="localesOptionsModel" class="org.riotfamily.forms.element.support.select.StaticOptionsModel">
		<constructor-arg ref="websiteLocales" />
	</bean>

</beans>