<?xml version="1.0" encoding="UTF-8"?>
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:override="http://www.riotfamily.org/schema/common/override"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/util
		http://www.springframework.org/schema/util/spring-util-2.5.xsd
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
		http://www.riotfamily.org/schema/common/override
		http://www.riotfamily.org/schema/common/override-8.0.xsd">

	<bean id="pageFormInitializer" class="org.riotfamily.pages.riot.form.PageFormInitializer">
		<constructor-arg ref="pageTypeHierarchy" />
		<constructor-arg ref="contentFormRepository" />
	</bean>

	<bean id="sitePropertiesFormInitializer" class="org.riotfamily.pages.riot.form.SiteFormInitializer">
		<constructor-arg ref="contentFormRepository" />
	</bean>

	<!-- Overrides -->

	<override:bean ref="componentFormController" class="org.riotfamily.pages.riot.form.PagePropertiesFormController">
		<constructor-arg ref="formContextFactory" />
		<constructor-arg ref="contentFormRepository" />
		<constructor-arg ref="transactionManager" />
		<constructor-arg ref="cacheService" />
	</override:bean>
	
	<override:add ref="messageBasenames" append="true">
		<value>classpath:/org/riotfamily/pages/runtime/i18n/messages</value>
	</override:add>
	
	<override:add ref="customStyleSheets">
		<value>style/riot-pages.css</value>
	</override:add>
	
	<override:add ref="formRepository" property="configLocations" append="true">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>
	 	 	
	<override:add ref="resourceMappings" append="true">			
		<bean class="org.riotfamily.core.resource.ResourceMapping">
			<property name="path" value="/" />
			<property name="location" value="classpath:/org/riotfamily/pages/runtime/resources/" />
		</bean>
	</override:add>
	
	<override:properties ref="riotUserDao">
		<property name="entityClass" value="org.riotfamily.pages.riot.security.SiteUser" />
	</override:properties>
	
	<!-- DAOs and models -->

	<bean id="siteRiotDao" class="org.riotfamily.pages.riot.dao.SiteRiotDao" />

 	<bean id="pageRiotDao" class="org.riotfamily.pages.riot.dao.PageRiotDao" />
	
	<bean id="locales" class="org.riotfamily.pages.riot.form.SiteLocalesOptionsModel" />

	<!-- Policies -->
	
	<bean id="siteUserPolicy" class="org.riotfamily.pages.riot.security.SiteUserPolicy">
		<constructor-arg ref="pageResolver" />
	</bean>
	
	<bean id="systemPagePolicy" class="org.riotfamily.pages.riot.security.SystemPagePolicy" />
	
	<bean id="masterPagePolicy" class="org.riotfamily.pages.riot.security.MasterPagePolicy" />
	
	<!--  FreeMarker Object Wrappers  -->
	
	<bean id="siteObjectWrapperPlugin" class="org.riotfamily.pages.view.SiteObjectWrapperPlugin" />
	
	<bean id="pageObjectWrapperPlugin" class="org.riotfamily.pages.view.PageObjectWrapperPlugin">
		<property name="pathConverter" ref="pathConverter" />
	</bean>
	
	<bean id="sitemap" class="org.riotfamily.core.screen.list.TreeListScreen">
		<property name="icon" value="sitemap" />
		<property name="dao" ref="pageRiotDao" />
		<property name="columns">
			<list>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="property" value="title" />
				</bean>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="property" value="pathComponent" />
				</bean>
				<bean class="org.riotfamily.core.screen.list.ColumnConfig">
					<property name="renderer">
						<bean class="org.riotfamily.pages.riot.ui.PublishStatusRenderer" />
					</property>
				</bean>
			</list>
		</property>
		<property name="commands">
			<list>
				<bean class="org.riotfamily.core.screen.list.command.impl.EditCommand" />
				<bean class="org.riotfamily.pages.riot.command.GotoPageCommand" />
				<bean class="org.riotfamily.core.screen.list.command.impl.MoveUpCommand" />
					<bean class="org.riotfamily.core.screen.list.command.impl.MoveDownCommand" />
				<bean class="org.riotfamily.core.screen.list.command.impl.clipboard.CutCommand" />
				<bean class="org.riotfamily.core.screen.list.command.impl.clipboard.CopyCommand" />
				<bean class="org.riotfamily.core.screen.list.command.impl.clipboard.PasteCommand" />
				<bean class="org.riotfamily.core.screen.list.command.impl.DeleteCommand" />
				<bean class="org.riotfamily.pages.riot.command.PublishPageCommand" />
				<bean class="org.riotfamily.pages.riot.command.UnpublishPageCommand" />
				<bean class="org.riotfamily.core.screen.list.command.impl.AddCommand" />
				<bean class="org.riotfamily.pages.riot.command.TranslatePageCommand" />
			</list>
		</property>
		<property name="itemScreen">
			<bean id="page" class="org.riotfamily.core.screen.form.FormScreen" autowire="constructor">
				<property name="icon" value="page" />
			</bean>
		</property>
	</bean>
	
	<bean id="sitemaps" class="org.riotfamily.core.screen.list.TreeListScreen">
			<property name="icon" value="world" />
			<property name="dao" ref="siteRiotDao" />
			<property name="columns">
				<list>
					<bean class="org.riotfamily.core.screen.list.ColumnConfig">
						<property name="property" value="locale" />
					</bean>
					<bean class="org.riotfamily.core.screen.list.ColumnConfig">
						<property name="property" value="name" />
					</bean>
				</list>
			</property>
			<property name="commands">
				<list>
					<bean class="org.riotfamily.core.screen.list.command.impl.EditCommand" />
					<!-- <bean class="org.riotfamily.pages.riot.command.GotoSiteCommand" /> -->
				</list>
			</property>
			<property name="itemScreen">
				<ref bean="sitemap" />
			</property>
		</bean>
	
	<override:add ref="systemScreens">
		<bean id="sites" class="org.riotfamily.core.screen.list.TreeListScreen">
			<property name="icon" value="world" />
			<property name="dao" ref="siteRiotDao" />
			<property name="columns">
				<list>
					<bean class="org.riotfamily.core.screen.list.ColumnConfig">
						<property name="property" value="locale" />
					</bean>
					<bean class="org.riotfamily.core.screen.list.ColumnConfig">
						<property name="property" value="name" />
					</bean>
					<bean class="org.riotfamily.core.screen.list.ColumnConfig">
						<property name="property" value="enabled" />
					</bean>
				</list>
			</property>
			<property name="commands">
				<list>
					<bean class="org.riotfamily.core.screen.list.command.impl.EditCommand" />
					<!-- <bean class="org.riotfamily.pages.riot.command.GotoSiteCommand" /> -->
					<bean class="org.riotfamily.core.screen.list.command.impl.MoveUpCommand" />
					<bean class="org.riotfamily.core.screen.list.command.impl.MoveDownCommand" />
					<bean class="org.riotfamily.core.screen.list.command.impl.DeleteCommand" />
					<bean class="org.riotfamily.core.screen.list.command.impl.AddCommand" />
				</list>
			</property>
			<property name="itemScreen">
				<bean id="site" class="org.riotfamily.core.screen.form.FormScreen" autowire="constructor">
				</bean>
			</property>
		</bean>
	</override:add>
	
</beans>
