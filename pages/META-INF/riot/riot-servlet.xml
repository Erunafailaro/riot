<?xml version="1.0" encoding="UTF-8"?>
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:override="http://www.riotfamily.org/schema/common/override"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/util
		http://www.springframework.org/schema/util/spring-util-2.5.xsd
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
		http://www.riotfamily.org/schema/common/override
		http://www.riotfamily.org/schema/common/override-7.0.xsd">
		
	<!--
		- Controller that displays the sitemap as DHTML tree. Used by the
		- internalLink form element.
		-->
	<bean id="pageChooserController" name="/pages/chooser"
		class="org.riotfamily.pages.riot.chooser.PageChooserController">

		<constructor-arg ref="pageDao" />
		<constructor-arg ref="pathCompleter" />
	</bean>

	<bean id="pageFormInitializer" class="org.riotfamily.pages.riot.form.PageFormInitializer">
		<constructor-arg ref="handlerNameHierarchy" />
		<constructor-arg ref="contentFormRepository" />
	</bean>

	<bean id="sitePropertiesFormInitializer" class="org.riotfamily.pages.riot.form.SiteFormInitializer">
		<constructor-arg ref="contentFormRepository" />
	</bean>

	<!-- Overrides -->

	<override:bean ref="componentFormController" class="org.riotfamily.pages.riot.form.PagePropertiesFormController">
		<constructor-arg ref="contentFormRepository" />
		<constructor-arg ref="transactionManager" />
		<constructor-arg ref="componentDao" />
		<property name="formContextFactory" ref="formContextFactory" />
	</override:bean>
	
	<override:add ref="messageBasenames">
		<value>classpath:/org/riotfamily/pages/runtime/i18n/messages</value>
	</override:add>
	
	<override:add ref="customStyleSheets">
		<value>style/riot-pages.css</value>
	</override:add>
	
	<override:add ref="listRepository" property="configLocations">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>
	
	<override:add ref="formRepository" property="configLocations" append="true">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>
	
	<override:add ref="editorRepository" property="configLocations">
		<value>classpath:/org/riotfamily/pages/runtime/riot-config.xml</value>
	</override:add>

	<override:put ref="customFormElements">
		<entry key="internalLink" value="org.riotfamily.pages.riot.form.InternalLinkField" />
		<entry key="{http://www.riotfamily.org/schema/pages/form-elements}link"
				value="org.riotfamily.pages.riot.form.InternalLinkField" />
	</override:put>
				
	<override:add ref="resourceMappings" append="true">			
		<bean class="org.riotfamily.riot.resource.ResourceMapping">
			<property name="path" value="/" />
			<property name="location" value="classpath:/org/riotfamily/pages/runtime/resources/" />
		</bean>
	</override:add>
	
	<override:properties ref="riotUserDao">
		<property name="entityClass" value="org.riotfamily.pages.riot.security.SiteUser" />
		<property name="initialUser">
			<bean class="org.riotfamily.pages.riot.security.SiteUser">
				<property name="id" value="admin" />
				<property name="newPassword" value="admin" />
				<property name="role" value="admin" />				
			</bean>
		</property>
	</override:properties>
	
	<override:add ref="roles" append="true">
     	<value>siteUser</value>
    </override:add>     
	
	<!-- DAOs and models -->

	<bean id="siteRiotDao" class="org.riotfamily.pages.riot.dao.SiteRiotDao">
		<property name="pageDao" ref="pageDao" />
	</bean>

 	<bean id="pageRiotDao" class="org.riotfamily.pages.riot.dao.PageRiotDao">
		<property name="pageDao" ref="pageDao" />
	</bean>
	
	<bean id="pageAliasRiotDao" class="org.riotfamily.riot.hibernate.dao.HqlParentChildDao">
		<property name="sessionFactory" ref="sessionFactory" />
		<property name="entityClass" value="org.riotfamily.pages.model.PageAlias" />
		<property name="parentProperty" value="site" />
	</bean>

	<bean id="locales" class="org.riotfamily.pages.riot.form.SiteLocalesOptionsModel">
		<constructor-arg ref="pageDao" />
	</bean>
	
	<!-- Page Commands -->

	<bean id="publishPageCommand" class="org.riotfamily.pages.riot.command.PublishPageCommand">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="publishStatusCommand" class="org.riotfamily.pages.riot.command.PublishStatus" />
		
	<bean id="discardPageCommand" class="org.riotfamily.pages.riot.command.DiscardPageCommand">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="moveUpPageCommand" class="org.riotfamily.pages.riot.command.SwapPageCommand">
		<property name="swapWith" value="-1" />
	</bean>

	<bean id="moveDownPageCommand" class="org.riotfamily.pages.riot.command.SwapPageCommand">
		<property name="swapWith" value="1" />
	</bean>

	<bean id="cutPageCommand" class="org.riotfamily.pages.riot.command.CutPageCommand" />

	<bean id="editPageCommand" class="org.riotfamily.pages.riot.command.EditPageCommand">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="gotoPageCommand" class="org.riotfamily.pages.riot.command.GotoPageCommand">
		<constructor-arg ref="pathCompleter" />
		<property name="windowName" value="preview" />
	</bean>

	<bean id="showChildPagesCommand" class="org.riotfamily.pages.riot.command.ShowChildPagesCommand" />

	<bean id="pastePageCommand" class="org.riotfamily.pages.riot.command.PastePageCommand">
		<constructor-arg ref="pageDao" />
	</bean>

	<bean id="gotoSiteCommand" class="org.riotfamily.pages.riot.command.GotoSiteCommand">
		<property name="windowName" value="preview" />
	</bean>
	
	<!-- Policy -->
	
	<bean class="org.riotfamily.pages.riot.security.SiteUserPolicy">
		<constructor-arg ref="pageDao" />
	</bean>
	
</beans>