<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:db="http://www.riotfamily.org/schema/revolt"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.riotfamily.org/schema/revolt
		http://www.riotfamily.org/schema/revolt/revolt.xsd
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

	<db:history module="pages" data-source="riotDataSource" depends="components">
		<db:change-set id="initial">

 			<db:create-table name="riot_sites">
				<db:column name="id" type="BIGINT" not-null="true" primary-key="true" auto-increment="true" />
				<db:column name="name" type="VARCHAR" length="255" />
				<db:column name="enabled" type="BIT" />
				<db:column name="locale" type="VARCHAR" length="5" />
				<db:column name="theme" type="VARCHAR" length="255" />
				<db:column name="hostName" type="VARCHAR" length="255" />
				<db:column name="pathPrefix" type="VARCHAR" length="255" />
				<db:column name="masterSite" type="BIGINT" />
				<db:column name="pos" type="BIGINT" />
			</db:create-table>
			
			<db:add-unique-constraint name="riot_site_name" table="riot_sites" on="name" />
			
			<db:add-foreign-key table="riot_sites" name="riot_site_master" references="riot_sites">
				<db:ref local="masterSite" foreign="id" />
			</db:add-foreign-key>
			
			<db:create-table name="riot_site_aliases">
				<db:column name="site" type="BIGINT" not-null="true" />
				<db:column name="hostName" type="VARCHAR" length="255" />
			</db:create-table>
			
			<db:add-foreign-key table="riot_site_aliases" name="riot_site_alias_site" references="riot_sites">
				<db:ref local="site" foreign="id" />
			</db:add-foreign-key>
			
			<db:create-table name="riot_page_nodes">
				<db:column name="id" type="BIGINT" not-null="true" primary-key="true" auto-increment="true" />
				<db:column name="parent" type="BIGINT" />
				<db:column name="handlerName" type="VARCHAR" length="255" />
				<db:column name="hidden" type="BIT" />
				<db:column name="systemNode" type="BIT" />
				<db:column name="pos" type="INTEGER" />
			</db:create-table>
			
			<db:add-foreign-key table="riot_page_nodes" name="riot_page_nodes_parent" references="riot_page_nodes">
				<db:ref local="parent" foreign="id" />
			</db:add-foreign-key>

			<db:create-table name="riot_pages">
				<db:column name="id" type="BIGINT" not-null="true" primary-key="true" auto-increment="true" />
				<db:column name="node" type="BIGINT" />
				<db:column name="site" type="BIGINT" />
				<db:column name="published" type="BIT" />
				<db:column name="creationDate" type="TIMESTAMP" />
				<db:column name="pathComponent" type="VARCHAR" length="255" />
				<db:column name="hidden" type="BIT" />
				<db:column name="folder" type="BIT" />
				<db:column name="`path`" type="VARCHAR" length="255" />
				<db:column name="wildcardInPath" type="BIT" />
				<db:column name="pageProperties" type="BIGINT" />
			</db:create-table>
			
			<db:add-foreign-key table="riot_pages" name="riot_pages_node" references="riot_page_nodes">
				<db:ref local="node" foreign="id" />
			</db:add-foreign-key>
			<db:add-foreign-key table="riot_pages" name="riot_pages_site" references="riot_sites">
				<db:ref local="site" foreign="id" />
			</db:add-foreign-key>

			<db:create-table name="riot_page_aliases">
				<db:column name="id" type="BIGINT" not-null="true" primary-key="true" auto-increment="true" />
				<db:column name="site" type="BIGINT" />
				<db:column name="`path`" type="VARCHAR" length="255" not-null="true" />
				<db:column name="page" type="BIGINT" />
			</db:create-table>
			
			<db:add-foreign-key table="riot_page_aliases" name="riot_page_aliases_site" references="riot_sites">
				<db:ref local="site" foreign="id" />
			</db:add-foreign-key>
			<db:add-foreign-key table="riot_page_aliases" name="riot_page_aliases_page" references="riot_pages">
				<db:ref local="page" foreign="id" />
			</db:add-foreign-key>
			
			<db:add-foreign-key name="riot_page_content_container" table="riot_pages" references="riot_content_containers">
			     <db:ref local="pageProperties" foreign="id"/>
			</db:add-foreign-key>
			
			<db:create-table name="riot_page_wrappers">
			     <db:column name="id" type="BIGINT" primary-key="true" />
			     <db:column name="page" type="BIGINT" />
			</db:create-table>
            
            <db:add-foreign-key name="riot_page_wrapper_id" references="riot_value_wrappers" table="riot_page_wrappers">
                 <db:ref local="id" foreign="id" />
            </db:add-foreign-key>
			
            <db:add-foreign-key name="riot_page_wrapper_page" references="riot_pages" table="riot_page_wrappers">
                 <db:ref local="page" foreign="id" />
            </db:add-foreign-key>
            
		</db:change-set>

	</db:history>

</beans>