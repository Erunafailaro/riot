<project default="update-skeleton">

	<available property="regexpmapper.available" 
		classname="org.apache.tools.ant.util.RegexpPatternMapper" />
	
	<property name="target" value="data" />
	
	<target name="update-skeleton">
		<fail unless="source">
			A source direcory must be specified. Use the -Dsource command line argument.
		</fail>

		<basename file="${source}" property="project.name" />
		
		<mkdir dir="${target}" />
		<delete>
			<fileset dir="${target}">
				<exclude name="**/CVS" />
			</fileset>
		</delete>
		
		<antcall target="-copy-skeleton" />
		<antcall target="-copy-cvsignore" />
		<antcall target="-regexpmapper-notice" />
	</target>
	
	
	<target name="-copy-skeleton">
		<copy todir="${target}" includeemptydirs="true" overwrite="true">
			<fileset dir="${source}">
				<exclude name=".project" />
				<exclude name=".settings/**" />
				<exclude name="src/**" />
				<exclude name="conf/**/tomcat.properties" />
				<exclude name="lib/**" />
				<exclude name="build/**" />
				<exclude name="webapp/WEB-INF/lib/**" />
				<exclude name="webapp/WEB-INF/classes/**" />
				<exclude name="webapp/WEB-INF/temp/**" />
				<exclude name="webapp/WEB-INF/hibernate-mapppings/**" />
			</fileset>
		</copy>
		
		<touch mkdirs="true" file="${target}/src/.empty" />
		<touch mkdirs="true" file="${target}/lib/.empty" />
		<touch mkdirs="true" file="${target}/build/.empty" />
		<touch mkdirs="true" file="${target}/webapp/WEB-INF/lib/.empty" />
		<touch mkdirs="true" file="${target}/webapp/WEB-INF/classes/.empty" />
		<touch mkdirs="true" file="${target}/webapp/WEB-INF/temp/.empty" />
		<touch mkdirs="true" file="${target}/webapp/WEB-INF/hibernate-mapppings/.empty" />
		
		<replace file="${target}/build.xml" token="${project.name}" value="@project.name@" />
		
	</target>
					
	<target name="-regexpmapper-notice" unless="regexpmapper.available">
		<echo>
			This build file uses a RegexpPatternMapper to copy .cvsignore files
			to the target directory. Sice your Ant version does not support this
			feature the .cvsignore files WILL NOT be copied.
			
			http://ant.apache.org/manual/CoreTypes/mapper.html#regexp-mapper
		</echo>
	</target>

	<target name="-copy-cvsignore" if="regexpmapper.available">
		<copy todir="${target}" includeemptydirs="true" verbose="true">
			<fileset dir="${source}" defaultexcludes="no">
				<include name="**/.cvsignore" />
				<exclude name="**/CVS" />
			</fileset>
			<regexpmapper from="^(.*)\.(.*)$" to="\1_.\2" />
		</copy>
	</target>

</project>